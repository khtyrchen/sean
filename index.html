<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seanå–®å­—æ¢æ¸¬é©— (å…¨é¡Œåº«ç‰ˆ)</title>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
    <style>
        /* -------------------
           å¯æ„›æ‰‹ç¹ªé¢¨æ ¸å¿ƒæ¨£å¼
        ------------------- */
        :root {
            --paper-color: #fffdf0;
            --ink-color: #444;
            --accent-pink: #ffadad;
            --accent-blue: #a0c4ff;
            --accent-green: #9bf6ff;
            --accent-yellow: #fdffb6;
            --accent-orange: #ffd6a5;
            --border-thickness: 3px;
        }

        body {
            font-family: 'Patrick Hand', 'å¾®è»Ÿæ­£é»‘é«”', cursive, sans-serif;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0; color: var(--ink-color);
            background-color: #fcf8e3;
            background-image: radial-gradient(#f7d794 2px, transparent 2px);
            background-size: 20px 20px;
        }

        .container {
            background: var(--paper-color); padding: 2.5rem;
            border-radius: 20px 5px 25px 10px;
            border: var(--border-thickness) solid var(--ink-color);
            box-shadow: 8px 8px 0 rgba(0,0,0,0.15);
            text-align: center; width: 90%; max-width: 480px;
            position: relative; transform: rotate(-1deg);
        }

        .container::before {
            content: ''; position: absolute;
            top: -15px; left: 50%; transform: translateX(-50%);
            width: 120px; height: 35px; background-color: rgba(255, 255, 255, 0.6);
            border: 2px dashed #ccc; z-index: 1;
        }

        h1 { color: var(--ink-color); margin-bottom: 5px; font-size: 2.2rem; text-shadow: 2px 2px 0 #eee; }
        
        /* è¨ˆåˆ†æ¿æ¨£å¼ */
        .score-board {
            background-color: var(--accent-orange);
            display: inline-block;
            padding: 5px 20px;
            border-radius: 20px;
            border: 2px dashed var(--ink-color);
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 15px;
            transform: rotate(1deg);
        }

        .btn {
            font-family: 'Patrick Hand', cursive; background-color: var(--accent-green);
            color: var(--ink-color); border: var(--border-thickness) solid var(--ink-color);
            padding: 10px 20px; font-size: 1.3rem; border-radius: 30px;
            cursor: pointer; margin: 8px; transition: all 0.2s ease;
            font-weight: bold; box-shadow: 4px 4px 0 var(--ink-color);
            width: 100%; max-width: 320px;
        }
        .btn:hover { transform: translate(-2px, -2px) rotate(1deg); background-color: #c7ffff; }
        .btn:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0 var(--ink-color); }
        
        .btn-audio { background-color: var(--accent-blue); } .btn-audio:hover { background-color: #cce0ff; }
        .btn-submit { background-color: var(--accent-yellow); } .btn-submit:hover { background-color: #ffffd1; }
        .btn-next { background-color: var(--accent-pink); display:none; } .btn-next:hover { background-color: #ffd1d1; }
        
        /* è¨­å®šå€å¡Šæ¨£å¼ */
        .settings-area {
            background-color: #fff; border: 2px dashed #ccc;
            padding: 15px; border-radius: 15px; margin-bottom: 20px;
            text-align: left;
        }
        .setting-label { font-size: 1rem; color: #888; display: block; margin-bottom: 5px; }
        select, input[type="range"] { width: 100%; margin-bottom: 10px; cursor: pointer; }
        select { padding: 5px; font-size: 1rem; border: 2px solid #ddd; border-radius: 5px; }

        .input-group { margin: 20px auto; text-align: left; max-width: 320px; position: relative; }
        .input-label { font-size: 1.2rem; color: var(--ink-color); margin-bottom: 8px; display: block; font-weight: bold; }
        
        input[type="text"] { 
            font-family: 'Patrick Hand', 'å¾®è»Ÿæ­£é»‘é«”', monospace; padding: 12px 15px; font-size: 1.5rem;
            width: 100%; border: 3px dashed #aaa; border-radius: 10px; box-sizing: border-box;
            background-color: #fffaf0; outline: none; transition: 0.3s;
            background-image: repeating-linear-gradient(transparent, transparent 38px, #e5e0d0 39px, #e5e0d0 40px);
            background-attachment: local; line-height: 40px;
        }
        input[type="text"]:focus { border-color: var(--accent-blue); border-style: solid; }
        
        input.correct-input { border: 3px solid #77dd77 !important; background-color: #eaffea; }
        input.wrong-input { border: 3px solid #ff6961 !important; background-color: #ffe6e6; }

        .cards-area { display: flex; gap: 15px; justify-content: center; margin: 25px 0; }
        
        .answer-box { 
            background-color: #f0f0f0; color: #888; padding: 10px 15px; 
            border-radius: 12px; cursor: pointer; border: 3px dashed #ccc; font-size: 1.2rem; flex: 1;
            transition: all 0.3s; transform: rotate(-2deg); position: relative;
        }
        .answer-box:nth-child(2) { transform: rotate(2deg); }
        .answer-box:hover { transform: scale(1.05) rotate(0deg); background-color: #e9e9e9; }
        
        .answer-box.revealed { 
            background-color: var(--accent-yellow); color: var(--ink-color);
            border: 3px solid var(--ink-color); font-weight: bold;
            transform: rotate(0deg) scale(1.05); box-shadow: 3px 3px 0 rgba(0,0,0,0.1);
        }

        /* æ‰£åˆ†æç¤ºå°æ¨™ç±¤ */
        .minus-point {
            position: absolute; top: -10px; right: -10px;
            background: #ff6961; color: white; border-radius: 50%;
            width: 25px; height: 25px; font-size: 0.8rem; line-height: 25px;
            font-weight: bold; display: none;
        }
        .revealed .minus-point { display: block; }

        .message { margin-top: 20px; font-weight: bold; min-height: 30px; font-size: 1.3rem; }
        .correct-msg { color: #44a047; text-shadow: 1px 1px 0 #a8e6cf; } 
        .wrong-msg { color: #d32f2f; text-shadow: 1px 1px 0 #ffcdd2; }
        .partial-msg { color: #f57c00; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ§ 2026.02.04</h1>
    
    <div class="score-board">
        ğŸ’° ç¸½åˆ†: <span id="score-val">0</span>
    </div>
    
    <div class="settings-area">
        <label class="setting-label">ğŸ—£ï¸ é¸æ“‡ç™¼éŸ³ (Voice)ï¼š</label>
        <select id="voice-select" onchange="testVoice()">
            <option value="">è¼‰å…¥ä¸­...</option>
        </select>
        
        <label class="setting-label">ğŸ¢ èªé€Ÿèª¿æ•´ (Speed)ï¼š<span id="speed-val">1</span></label>
        <input type="range" id="rate-range" min="0.5" max="1.5" step="0.1" value="1" oninput="updateSpeedLabel()">
    </div>

    <p style="font-size: 1.2rem;">ç¬¬ <span id="current-index" style="font-weight:bold; color: var(--accent-blue);">1</span> é¡Œ / å…± <span id="total-count">0</span> é¡Œ</p>

    <button class="btn btn-audio" onclick="playAudio()">ğŸ”Š è©¦è½ / æ’­æ”¾ (Play)</button>

    <div class="cards-area">
        <div id="box-zh" class="answer-box" onclick="toggleZh()">
            ğŸ™ˆ å·çœ‹ä¸­æ–‡ <span class="minus-point">-2</span>
        </div>
        <div id="box-en" class="answer-box" onclick="toggleEn()">
            ğŸ™ˆ å·çœ‹è‹±æ–‡ <span class="minus-point">-2</span>
        </div>
    </div>
    
    <div class="input-group">
        <label class="input-label">âœï¸ è«‹è¼¸å…¥è‹±æ–‡ (English)ï¼š</label>
        <input type="text" id="input-en" placeholder="æ‹¼å¯«..." autocomplete="off">
    </div>

    <div class="input-group">
        <label class="input-label">âœï¸ è«‹è¼¸å…¥ä¸­æ–‡ (Chinese)ï¼š</label>
        <input type="text" id="input-zh" placeholder="ä¸­æ–‡æ„æ€..." autocomplete="off">
    </div>
    
    <button class="btn btn-submit" onclick="checkAnswer()">âœ¨ é€å‡ºç­”æ¡ˆ (Submit)</button>
    <button class="btn btn-next" onclick="nextQuestion()" id="next-btn">â¡ï¸ ä¸‹ä¸€é¡Œ (Next)</button>

    <div id="message" class="message"></div>

</div>

<script>
    // å–®å­—åº« (2026.02.04)
    const fullDatabase = [
        { en: "couch", zh: ["é•·æ¤… é•·æ²™ç™¼","é•·æ²™ç™¼ é•·æ¤…"] },
        { en: "cushion", zh: ["è»Ÿå¢Š åå¢Š","åå¢Š è»Ÿå¢Š"] },
        { en: "paper door", zh: "ç´™é–€" },
        { en: "wooden door", zh: "æœ¨é–€" },
        { en: "around", zh: "åˆ°è™•" },
        { en: "traditional Japanese house", zh: "å‚³çµ±çš„æ—¥å¼æˆ¿å­" },
        { en: "clock", zh: "æ™‚é˜" },
        { en: "mirror", zh: "é¡å­" },
        { en: "radio", zh: "æ”¶éŸ³æ©Ÿ" },
        { en: "frame", zh: "æ¡†æ¶" },
        { en: "painting", zh: ["åœ–ç•« æ²¹æ¼†","æ²¹æ¼† åœ–ç•«"] },
        { en: "stand in a circle", zh: "ç«™è‘—åœæˆä¸€å€‹åœˆ" },
        { en: "stand inside the circle", zh: "ç«™åœ¨åœ“åœˆè£¡é¢" },
        { en: "while", zh: "ç•¶(å…©ä»¶äº‹åŒæ™‚ç™¼ç”Ÿ)" },
        { en: "when", zh: "ç•¶(æŒ‡ç‰¹å®šæ™‚é–“é»ç™¼ç”Ÿ)" },
        { en: "yesterday", zh: "æ˜¨å¤©" },
        { en: "tomorrow", zh: "æ˜å¤©" },
        { en: "cut-outs", zh: "å‰ªç´™" },
        { en: "cut out", zh: "å‰ªä¸‹ä¾†" },
        { en: "writing tip", zh: "å¯«ä½œæç¤º" },
        { en: "adjective", zh: "å½¢å®¹è©" },
        { en: "pronoun", zh: "ä»£åè©" },
        { en: "noun", zh: "åè©" },
        { en: "verb", zh: "å‹•è©" },
        { en: "adverb", zh: "å‰¯è©" },
        { en: "subject", zh: ["ä¸»è© ç§‘ç›®","ç§‘ç›® ä¸»è©"] },
        { en: "cenvenience store", zh: "ä¾¿åˆ©å•†åº—" },
        { en: "boots", zh: "é´å­" },
    ];

    let quizList = []; 
    let currentIndex = 0;
    let currentItem = {};
    let isRevealedEn = false;
    let isRevealedZh = false;
    let voices = []; 
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    // --- è¨ˆåˆ†ç³»çµ±è®Šæ•¸ ---
    let totalScore = 0;
    let currentRoundScore = 10;
    let hasPeekedZhThisRound = false;
    let hasPeekedEnThisRound = false;
    let isQuestionDone = false; 

    function playSoundEffect(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        if (type === 'correct') {
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(500, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.5);
            setTimeout(() => {
                const osc2 = audioCtx.createOscillator();
                const gain2 = audioCtx.createGain();
                osc2.connect(gain2); gain2.connect(audioCtx.destination);
                osc2.type = 'sine';
                osc2.frequency.setValueAtTime(800, audioCtx.currentTime);
                osc2.frequency.exponentialRampToValueAtTime(1500, audioCtx.currentTime + 0.1);
                gain2.gain.setValueAtTime(0.2, audioCtx.currentTime);
                gain2.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                osc2.start(); osc2.stop(audioCtx.currentTime + 0.4);
            }, 100);
        } else if (type === 'wrong') {
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
            oscillator.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.3);
        }
    }

    function shuffleArray(array) {
        let newArray = [...array]; 
        for (let i = newArray.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
        }
        return newArray;
    }

    function populateVoiceList() {
        if (typeof speechSynthesis === 'undefined') return;
        voices = speechSynthesis.getVoices();
        const englishVoices = voices.filter(v => v.lang.includes('en'));
        const voiceSelect = document.getElementById("voice-select");
        voiceSelect.innerHTML = "";

        if(englishVoices.length === 0) {
            const option = document.createElement('option');
            option.textContent = "ç³»çµ±ç„¡è‹±æ–‡ç™¼éŸ³ï¼Œä½¿ç”¨é è¨­";
            voiceSelect.appendChild(option);
            return;
        }

        englishVoices.forEach((voice, index) => {
            const option = document.createElement('option');
            option.textContent = `${voice.name} (${voice.lang})`;
            option.value = index; 
            option.setAttribute('data-name', voice.name);
            if (voice.name.includes('Google US') || voice.name.includes('Zira')) {
                option.selected = true;
            }
            voiceSelect.appendChild(option);
        });
    }

    function updateSpeedLabel() {
        const rate = document.getElementById("rate-range").value;
        document.getElementById("speed-val").innerText = rate;
    }

    function testVoice() {
        window.speechSynthesis.cancel();
        playAudio();
    }

    document.addEventListener("DOMContentLoaded", () => {
        // âš ï¸ ä¿®æ”¹ï¼šå–å¾—å…¨éƒ¨é¡Œåº«ä¸¦æ‰“äº‚ï¼Œä¸å†åªå–å‰ 10 é¡Œ
        const shuffledDB = shuffleArray(fullDatabase);
        quizList = shuffledDB; 
        
        document.getElementById("total-count").innerText = quizList.length;
        
        loadQuestion();
        populateVoiceList();
        if (window.speechSynthesis.onvoiceschanged !== undefined) {
            window.speechSynthesis.onvoiceschanged = populateVoiceList;
        }
        document.getElementById("input-en").addEventListener("keypress", (e) => { if (e.key === "Enter") checkAnswer(); });
        document.getElementById("input-zh").addEventListener("keypress", (e) => { if (e.key === "Enter") checkAnswer(); });
    });

    function loadQuestion() {
        if (currentIndex >= quizList.length) {
            document.querySelector(".container").innerHTML = `
                <h2>ğŸ† æ¸¬é©—çµæŸï¼</h2>
                <div class="score-board" style="font-size:2rem; margin:20px 0;">æœ€çµ‚å¾—åˆ†: ${totalScore}</div>
                <p>æ­å–œå®Œæˆæ‰€æœ‰é¡Œç›®ï¼</p>
                <button class="btn btn-submit" onclick="location.reload()">ğŸ”„ å†ç©ä¸€æ¬¡</button>
            `;
            return;
        }
        
        // --- é‡ç½®æ¯é¡Œç‹€æ…‹ ---
        currentItem = quizList[currentIndex];
        currentRoundScore = 10;
        hasPeekedZhThisRound = false;
        hasPeekedEnThisRound = false;
        isQuestionDone = false;
        
        document.getElementById("current-index").innerText = currentIndex + 1;
        const inputEn = document.getElementById("input-en");
        const inputZh = document.getElementById("input-zh");
        inputEn.value = ""; inputZh.value = "";
        inputEn.className = ""; inputZh.className = "";
        document.getElementById("message").innerText = "";
        document.getElementById("next-btn").style.display = "none";
        isRevealedEn = false; isRevealedZh = false;
        
        // é‡ç½®å¡ç‰‡é¡¯ç¤º (æ›´æ–°æ‰£åˆ†æ¨™ç±¤æ–‡å­—)
        const boxEn = document.getElementById("box-en");
        const boxZh = document.getElementById("box-zh");
        boxEn.className = "answer-box"; boxEn.innerHTML = 'ğŸ™ˆ å·çœ‹è‹±æ–‡ <span class="minus-point">-2</span>';
        boxZh.className = "answer-box"; boxZh.innerHTML = 'ğŸ™ˆ å·çœ‹ä¸­æ–‡ <span class="minus-point">-2</span>';
        
        inputEn.focus();
    }

    function toggleZh() {
        if (!isQuestionDone && !hasPeekedZhThisRound) {
            currentRoundScore -= 2;
            hasPeekedZhThisRound = true;
        }

        const box = document.getElementById("box-zh");
        if (isRevealedZh) {
            box.innerHTML = 'ğŸ™ˆ å·çœ‹ä¸­æ–‡ <span class="minus-point">-2</span>'; 
            box.className = "answer-box"; 
            isRevealedZh = false;
        } else {
            const displayZh = Array.isArray(currentItem.zh) ? currentItem.zh.join(" / ") : currentItem.zh;
            box.innerHTML = displayZh + ' <span class="minus-point">-2</span>'; 
            box.className = "answer-box revealed"; 
            isRevealedZh = true;
        }
    }

    function toggleEn() {
        if (!isQuestionDone && !hasPeekedEnThisRound) {
            currentRoundScore -= 2;
            hasPeekedEnThisRound = true;
        }

        const box = document.getElementById("box-en");
        if (isRevealedEn) { 
            box.innerHTML = 'ğŸ™ˆ å·çœ‹è‹±æ–‡ <span class="minus-point">-2</span>'; 
            box.className = "answer-box"; 
            isRevealedEn = false; 
        } else { 
            box.innerHTML = currentItem.en + ' <span class="minus-point">-2</span>'; 
            box.className = "answer-box revealed"; 
            isRevealedEn = true; 
        }
    }

    function playAudio() {
        if ('speechSynthesis' in window) {
            window.speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(currentItem.en);
            const rate = document.getElementById("rate-range").value;
            utterance.rate = rate;

            const voiceSelect = document.getElementById("voice-select");
            const selectedOption = voiceSelect.selectedOptions[0];
            
            if (selectedOption) {
                const voiceName = selectedOption.getAttribute('data-name');
                const selectedVoice = voices.find(v => v.name === voiceName);
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                }
            }

            utterance.lang = 'en-US'; 
            window.speechSynthesis.speak(utterance);
        }
    }
    
    function checkAnswer() {
        if (isQuestionDone) return;

        const inputEn = document.getElementById("input-en");
        const inputZh = document.getElementById("input-zh");
        const msg = document.getElementById("message");
        
        const valEn = inputEn.value.trim().toLowerCase();
        const valZh = inputZh.value.trim(); 

        if (valEn === "" && valZh === "") { playAudio(); return; }

        const isEnCorrect = (valEn === currentItem.en.toLowerCase());
        const validAnswers = Array.isArray(currentItem.zh) ? currentItem.zh : [currentItem.zh];
        const isZhCorrect = validAnswers.some(target => target === valZh);

        inputEn.className = isEnCorrect ? "correct-input" : "wrong-input";
        inputZh.className = isZhCorrect ? "correct-input" : "wrong-input";

        if (isEnCorrect && isZhCorrect) {
            // --- ç­”å°é‚è¼¯ ---
            isQuestionDone = true; 
            totalScore += Math.max(0, currentRoundScore); 
            document.getElementById("score-val").innerText = totalScore; 

            playSoundEffect('correct');
            msg.innerHTML = `ğŸ‰ é›™èªå…¨å°ï¼ (æœ¬é¡Œå¾— ${Math.max(0, currentRoundScore)} åˆ†)<br>Awesome!`;
            msg.className = "message correct-msg";
            document.getElementById("next-btn").style.display = "inline-block";
            
            if(!isRevealedZh) toggleZh();
            if(!isRevealedEn) toggleEn();
            
        } else if (isEnCorrect && !isZhCorrect) {
            playSoundEffect('wrong');
            msg.innerText = "âš ï¸ è‹±æ–‡å°äº†ï¼Œä½†ä¸­æ–‡æ„æ€è¦å†æƒ³æƒ³å–”ï¼";
            msg.className = "message partial-msg";
        } else if (!isEnCorrect && isZhCorrect) {
            playSoundEffect('wrong');
            msg.innerText = "âš ï¸ ä¸­æ–‡å°äº†ï¼Œä½†è‹±æ–‡æ‹¼å­—æœ‰éŒ¯å–”ï¼";
            msg.className = "message partial-msg";
            playAudio();
        } else {
            playSoundEffect('wrong');
            msg.innerText = "âŒ å…©å€‹éƒ½ä¸å¤ªå°ï¼Œå†è©¦ä¸€æ¬¡ï¼";
            msg.className = "message wrong-msg";
            playAudio();
        }
    }

    function nextQuestion() { currentIndex++; loadQuestion(); }
</script>
</body>
</html>

